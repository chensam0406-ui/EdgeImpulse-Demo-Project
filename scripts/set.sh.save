# 定義 log 檔案名稱 (例如: 1210.log)
LOG_FILENAME="${TODAY}.log"

# 定義 log 目錄。由於在主目錄執行，路徑為 logs/
LOG_DIR="logs"
LOG_FILE_PATH="${LOG_DIR}/${LOG_FILENAME}"

# 檢查並建立 logs 目錄
if [ ! -d "${LOG_DIR}" ]; then
    mkdir -p "${LOG_DIR}"
fi

# 檢查並建立 log 檔案
if [ ! -f "${LOG_FILE_PATH}" ]; then
    touch "${LOG_FILE_PATH}"
fi

# 在重定向發生前，先將確認資訊輸出到螢幕
echo "=========================================================="
echo "--- 日誌檔案已設定: ${LOG_FILE_PATH} ---"
echo "--- 注意：此終端機（Shell）的輸出已全部導向至此檔案！ ---"
echo "=========================================================="


# --- 2. 核心：使用 exec 重新導向 stdout (1) 和 stderr (2) ---

# 備份當前的標準輸出 (螢幕)，儲存在檔案描述符 3 中，以便之後可以還原。
exec 3>&1

# 將標準輸出 (1) 和標準錯誤 (2) 重新導向到日誌檔案 (使用 >> 進行追加)。
# 2>&1 表示將標準錯誤 (2) 導向到標準輸出 (1) 相同的目的地。
exec 1>>"${LOG_FILE_PATH}" 2>&1

# 在 log 檔案中記錄開始時間
echo ""
echo "--- [新工作流程開始記錄] 時間: $(date +'%Y-%m-%d %H:%M:%S') ---"
echo ""

# 現在，所有後續操作的輸出都會寫入 logs/MMDD.log
